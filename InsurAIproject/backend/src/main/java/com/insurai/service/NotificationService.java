package com.insurai.service; import com.insurai.dto.NotificationDto; import com.insurai.entity.Notification; import com.insurai.mapper.NotificationMapper; import com.insurai.repository.NotificationRepository; import org.springframework.stereotype.Service; import java.time.LocalDateTime; import java.util.List; import java.util.stream.Collectors; @Service public class NotificationService { private final NotificationRepository repo; private final NotificationMapper mapper; public NotificationService(NotificationRepository repo, NotificationMapper mapper){ this.repo=repo; this.mapper=mapper; } public NotificationDto create(Long userId, Long agentId, String title, String body){ Notification n=new Notification(); n.setUserId(userId); n.setAgentId(agentId); n.setTitle(title); n.setBody(body); n.setSeen(false); n.setCreatedAt(LocalDateTime.now()); return mapper.toDto(repo.save(n)); } public List<NotificationDto> getUserNotifications(Long userId){ return repo.findByUserIdOrderByCreatedAtDesc(userId).stream().map(mapper::toDto).collect(Collectors.toList()); } public List<NotificationDto> getAgentNotifications(Long agentId){ return repo.findByAgentIdOrderByCreatedAtDesc(agentId).stream().map(mapper::toDto).collect(Collectors.toList()); } public void markAsSeen(Long id){ Notification n = repo.findById(id).orElseThrow(()->new RuntimeException("Not found")); n.setSeen(true); repo.save(n); } public void markAllAsSeenForUser(Long userId){ repo.findByUserIdOrderByCreatedAtDesc(userId).forEach(n->{ n.setSeen(true); repo.save(n); }); } public void markAllAsSeenForAgent(Long agentId){ repo.findByAgentIdOrderByCreatedAtDesc(agentId).forEach(n->{ n.setSeen(true); repo.save(n); }); } }
