package com.insurai.service; import com.insurai.dto.UserDto; import com.insurai.entity.User; import com.insurai.mapper.UserMapper; import com.insurai.repository.UserRepository; import org.springframework.stereotype.Service; import java.util.List; import java.util.stream.Collectors; @Service public class UserService { private final UserRepository repo; private final UserMapper mapper; public UserService(UserRepository repo, UserMapper mapper){ this.repo=repo; this.mapper=mapper; } public List<UserDto> getAllAgents(){ return repo.findByRole("AGENT").stream().map(mapper::toDto).collect(Collectors.toList()); } public List<UserDto> getApprovedAgents(){ return repo.findByRoleAndApproved("AGENT",1).stream().map(mapper::toDto).collect(Collectors.toList()); } public UserDto approveAgent(Long id, Integer approved){ User u = repo.findById(id).orElseThrow(()->new RuntimeException("Agent not found")); u.setApproved(approved); return mapper.toDto(repo.save(u)); } public List<UserDto> getAllUsers(){ return repo.findAll().stream().map(mapper::toDto).collect(Collectors.toList()); } public void deleteUser(Long id){ repo.deleteById(id); } }
